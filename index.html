<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikacja dla Senior√≥w</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 100%;
            padding: 1rem;
        }
        .card {
            background-color: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .header {
            text-align: center;
        }
        .time-date {
            font-size: 2rem;
            font-weight: 600;
            color: #4a5568;
        }
        .menu-button {
            padding: 1.5rem;
            border-radius: 1rem;
            font-size: 1.25rem;
            font-weight: 600;
            transition: transform 0.2s;
            cursor: pointer;
            width: 100%;
        }
        .menu-button:hover {
            transform: scale(1.02);
        }
        .game-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        .game-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .game-title {
            font-size: 1rem;
            font-weight: 600;
        }
        .message-box {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 1rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        .message-box.show {
            opacity: 1;
        }
        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .delete-btn {
            background-color: #ef4444;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .delete-btn:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <!-- Kontener g≈Ç√≥wny aplikacji -->
    <div id="app-container" class="container bg-white p-6 rounded-3xl shadow-xl w-full max-w-lg transition-all duration-500 ease-in-out">
        
        <!-- Ekran g≈Ç√≥wny -->
        <div id="main-screen">
            <div class="header mb-6">
                <div id="time-display" class="text-5xl font-extrabold text-blue-700"></div>
                <div id="date-display" class="text-xl font-semibold text-gray-500"></div>
                <div id="user-info" class="text-lg font-semibold text-gray-700 mt-2"></div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <button onclick="showReminders()" class="menu-button bg-blue-500 text-white hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300">
                    Przypomnienia üîî
                </button>
                <button onclick="showGames()" class="menu-button bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                    Gry üéÆ
                </button>
            </div>
            <div class="grid grid-cols-1 gap-4 mb-6">
                <button onclick="showRanking()" class="menu-button bg-yellow-500 text-white hover:bg-yellow-600 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                    Ranking üèÜ
                </button>
            </div>


            <!-- Przyciski logowania, widoczne tylko dla niezalogowanych u≈ºytkownik√≥w -->
            <div id="auth-buttons" class="grid grid-cols-2 gap-4">
                <button onclick="signInWithGoogle()" class="menu-button bg-red-500 text-white hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-300 flex items-center justify-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/2048px-Google_%22G%22_logo.svg.png" class="w-6 h-6 mr-2" alt="Google Logo">
                    Zaloguj z Google
                </button>
                <button onclick="signInWithFacebook()" class="menu-button bg-blue-700 text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-500 flex items-center justify-center">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Facebook_Logo_%282019%29.svg/1024px-Facebook_Logo_%282019%29.svg.png" class="w-6 h-6 mr-2" alt="Facebook Logo">
                    Zaloguj z Facebook
                </button>
            </div>
            
            <!-- Przycisk wylogowania, widoczny tylko dla zalogowanych u≈ºytkownik√≥w -->
            <button id="logout-button" onclick="signOutUser()" class="hidden menu-button bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Wyloguj
            </button>
        </div>

        <!-- Ekran przypomnie≈Ñ -->
        <div id="reminders-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Moje Przypomnienia</h2>
            <div class="flex flex-col gap-4">
                <div class="flex items-center">
                    <input type="text" id="new-reminder-input" class="flex-grow p-3 rounded-l-lg border-2 border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Dodaj nowe przypomnienie...">
                    <button onclick="addReminder()" class="bg-blue-500 text-white p-3 rounded-r-lg hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300">Dodaj</button>
                </div>
                <div id="reminders-list" class="flex flex-col gap-2">
                    <!-- Przypomnienia bƒôdƒÖ ≈Çadowane dynamicznie -->
                </div>
            </div>
            <button onclick="showMainScreen()" class="menu-button mt-6 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu
            </button>
        </div>

        <!-- Ekran gier -->
        <div id="games-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Wybierz grƒô</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="showMemoryGame()" class="menu-button bg-yellow-400 text-gray-800 hover:bg-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-300">
                    <div class="game-card">
                        <span class="game-icon">üß†</span>
                        <span class="game-title">Gra Pamiƒôciowa</span>
                    </div>
                </button>
                <button onclick="showLogicGame()" class="menu-button bg-purple-400 text-white hover:bg-purple-500 focus:outline-none focus:ring-4 focus:ring-purple-300">
                    <div class="game-card">
                        <span class="game-icon">üß©</span>
                        <span class="game-title">Gra Logiczna</span>
                    </div>
                </button>
                <button onclick="showMathGame()" class="menu-button bg-teal-400 text-white hover:bg-teal-500 focus:outline-none focus:ring-4 focus:ring-teal-300">
                    <div class="game-card">
                        <span class="game-icon">‚ûï</span>
                        <span class="game-title">Gra Matematyczna</span>
                    </div>
                </button>
            </div>
            <button onclick="showMainScreen()" class="menu-button mt-6 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu gier
            </button>
        </div>
        
        <!-- Ekran rankingu -->
        <div id="ranking-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Rankingi</h2>
            <div id="ranking-list" class="flex flex-col gap-2">
                <!-- Wyniki ≈Çadowane dynamicznie -->
            </div>
            <button onclick="showMainScreen()" class="menu-button mt-6 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu
            </button>
        </div>

        <!-- Gra Pamiƒôciowa -->
        <div id="memory-game-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Gra Pamiƒôciowa</h2>
            <div id="memory-grid" class="grid grid-cols-4 gap-2 mb-4"></div>
            <div class="text-center text-xl font-semibold text-gray-700">Wynik: <span id="memory-score">0</span></div>
            <button onclick="resetMemoryGame()" class="menu-button mt-4 bg-orange-500 text-white hover:bg-orange-600 focus:outline-none focus:ring-4 focus:ring-orange-300">
                Restart
            </button>
            <button onclick="showGames()" class="menu-button mt-4 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu gier
            </button>
        </div>

        <!-- Gra Logiczna -->
        <div id="logic-game-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Gra Logiczna</h2>
            <div class="card bg-gray-100 mb-4">
                <p id="proverb-start" class="text-2xl text-center font-bold mb-4"></p>
                <div id="proverb-options" class="grid grid-cols-1 gap-4"></div>
            </div>
            <div class="text-center text-xl font-semibold text-gray-700">Wynik: <span id="logic-score">0</span></div>
            <button onclick="showGames()" class="menu-button mt-6 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu gier
            </button>
        </div>

        <!-- Gra Matematyczna -->
        <div id="math-game-screen" class="hidden">
            <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Gra Matematyczna</h2>
            <div class="card bg-gray-100 mb-4 text-center">
                <p id="math-problem" class="text-4xl font-bold text-blue-600 mb-4"></p>
                <input type="number" id="math-answer" class="w-full text-center text-3xl p-4 border-2 border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="Twoja odpowied≈∫">
            </div>
            <button onclick="checkMathAnswer()" class="menu-button bg-green-500 text-white hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-300">
                Sprawd≈∫
            </button>
            <div class="text-center text-xl font-semibold text-gray-700 mt-4">Wynik: <span id="math-score">0</span></div>
            <button onclick="showGames()" class="menu-button mt-6 bg-gray-500 text-white hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-300">
                Powr√≥t do menu gier
            </button>
        </div>
    </div>
    
    <!-- Pude≈Çko na wiadomo≈õci -->
    <div id="message-box" class="message-box"></div>

    <!-- Skrypty Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signInWithPopup, 
            GoogleAuthProvider, 
            FacebookAuthProvider, 
            signOut,
            signInWithCustomToken,
            signInAnonymously
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            onSnapshot,
            serverTimestamp,
            deleteDoc,
            doc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Zmienne globalne Firebase (udostƒôpniane przez ≈õrodowisko)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Inicjalizacja Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        let userId = null;
        let userName = 'Go≈õƒá';
        let isAuthReady = false;

        // Nas≈Çuchiwanie na zmiany stanu autoryzacji
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userId = user.uid;
                userName = user.displayName || `Go≈õƒá ${userId.substring(0, 4)}`;
                document.getElementById('auth-buttons').classList.add('hidden');
                document.getElementById('logout-button').classList.remove('hidden');
                document.getElementById('user-info').innerText = `Witaj, ${userName}!`;
                
                // Poka≈º userId w celach debugowania i udostƒôpniania
                const userIdDisplay = document.createElement('p');
                userIdDisplay.className = 'text-xs text-gray-400 mt-1';
                userIdDisplay.innerText = `Tw√≥j ID: ${userId}`;
                document.getElementById('user-info').appendChild(userIdDisplay);
                
                // Wczytaj przypomnienia po zalogowaniu
                loadReminders();

                showMessage(`Zalogowano jako ${userName}.`);
            } else {
                userId = null;
                userName = 'Go≈õƒá';
                document.getElementById('auth-buttons').classList.remove('hidden');
                document.getElementById('logout-button').classList.add('hidden');
                document.getElementById('user-info').innerText = 'Zaloguj siƒô, aby zapisywaƒá wyniki i przypomnienia.';
                showMessage('Wylogowano.');
            }
            isAuthReady = true;
        });
        
        // Funkcja logowania przez Google
        window.signInWithGoogle = async () => {
            try {
                const provider = new GoogleAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("B≈ÇƒÖd logowania Google:", error);
                if (error.code === 'auth/popup-blocked') {
                    showMessage("Logowanie nieudane. Prosimy wy≈ÇƒÖczyƒá blokowanie wyskakujƒÖcych okienek.", true);
                } else if (error.code === 'auth/unauthorized-domain') {
                    showMessage("B≈ÇƒÖd logowania: domena, na kt√≥rej uruchomiona jest aplikacja, nie zosta≈Ça dodana do autoryzowanych domen w konsoli Firebase.", true);
                } else {
                    showMessage("WystƒÖpi≈Ç b≈ÇƒÖd podczas logowania przez Google. Spr√≥buj ponownie.", true);
                }
            }
        };

        // Funkcja logowania przez Facebook
        window.signInWithFacebook = async () => {
            try {
                const provider = new FacebookAuthProvider();
                await signInWithPopup(auth, provider);
            } catch (error) {
                console.error("B≈ÇƒÖd logowania Facebook:", error);
                if (error.code === 'auth/popup-blocked') {
                    showMessage("Logowanie nieudane. Prosimy wy≈ÇƒÖczyƒá blokowanie wyskakujƒÖcych okienek.", true);
                } else if (error.code === 'auth/unauthorized-domain') {
                    showMessage("B≈ÇƒÖd logowania: domena, na kt√≥rej uruchomiona jest aplikacja, nie zosta≈Ça dodana do autoryzowanych domen w konsoli Firebase.", true);
                } else {
                    showMessage("WystƒÖpi≈Ç b≈ÇƒÖd podczas logowania przez Facebook. Spr√≥buj ponownie.", true);
                }
            }
        };

        // Funkcja wylogowania
        window.signOutUser = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("B≈ÇƒÖd wylogowania:", error);
                showMessage("B≈ÇƒÖd wylogowania. Spr√≥buj ponownie.", true);
            }
        };
        
        // Autoryzacja po za≈Çadowaniu strony
        (async () => {
          if (initialAuthToken) {
            try {
              await signInWithCustomToken(auth, initialAuthToken);
            } catch (error) {
              console.error('B≈ÇƒÖd autoryzacji tokenem, pr√≥ba logowania anonimowego:', error);
              await signInAnonymously(auth);
            }
          } else {
            await signInAnonymously(auth);
          }
        })();

        // Funkcja zapisywania wynik√≥w w Firestore
        async function saveScore(game, score) {
            if (!isAuthReady || !userId) {
                showMessage('Musisz byƒá zalogowany, aby zapisaƒá wynik.', true);
                return;
            }
            const collectionPath = `/artifacts/${appId}/public/data/scores`;
            try {
                await addDoc(collection(db, collectionPath), {
                    userId: userId,
                    userName: userName,
                    game: game,
                    score: score,
                    timestamp: serverTimestamp()
                });
                showMessage(`Wynik ${score} zapisany w grze ${game}!`);
            } catch (e) {
                console.error("B≈ÇƒÖd podczas dodawania dokumentu: ", e);
                showMessage("B≈ÇƒÖd podczas zapisywania wyniku.", true);
            }
        }

        // Funkcja ≈Çadowania wynik√≥w z Firestore
        window.loadScores = () => {
            if (!isAuthReady) {
                return;
            }
            const collectionPath = `/artifacts/${appId}/public/data/scores`;
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '<p class="text-center text-gray-500">≈Åadowanie rankingu...</p>';

            // Usuniƒôto orderBy() ze wzglƒôdu na potencjalne b≈Çƒôdy z indeksami
            const scoresQuery = query(collection(db, collectionPath));
            
            onSnapshot(scoresQuery, (querySnapshot) => {
                rankingList.innerHTML = '';
                if (querySnapshot.empty) {
                    rankingList.innerHTML = '<p class="text-center text-gray-500">Brak wynik√≥w do wy≈õwietlenia.</p>';
                    return;
                }
                
                const scores = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    scores.push(data);
                });

                // Sortowanie wynik√≥w po dacie i wyniku
                scores.sort((a, b) => b.score - a.score || (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                scores.forEach((score, index) => {
                    const scoreItem = document.createElement('div');
                    scoreItem.className = 'flex items-center justify-between p-4 bg-gray-100 rounded-xl';
                    scoreItem.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-2xl font-bold text-gray-600 mr-4">${index + 1}.</span>
                            <div>
                                <span class="font-semibold text-lg">${score.userName}</span>
                                <span class="text-sm text-gray-500 ml-2">(${score.game})</span>
                            </div>
                        </div>
                        <span class="text-2xl font-bold text-blue-600">${score.score}</span>
                    `;
                    rankingList.appendChild(scoreItem);
                });
            });
        };

        // --- Funkcje dla Przypomnie≈Ñ ---
        window.addReminder = async () => {
            if (!isAuthReady || !userId) {
                showMessage('Musisz byƒá zalogowany, aby dodaƒá przypomnienie.', true);
                return;
            }
            const reminderInput = document.getElementById('new-reminder-input');
            const reminderText = reminderInput.value.trim();
            if (reminderText === "") {
                showMessage("Wpisz tre≈õƒá przypomnienia.", true);
                return;
            }

            const collectionPath = `/artifacts/${appId}/users/${userId}/reminders`;
            try {
                await addDoc(collection(db, collectionPath), {
                    text: reminderText,
                    createdAt: serverTimestamp()
                });
                reminderInput.value = '';
                showMessage('Dodano nowe przypomnienie!');
            } catch (e) {
                console.error("B≈ÇƒÖd podczas dodawania przypomnienia: ", e);
                showMessage("B≈ÇƒÖd podczas dodawania przypomnienia.", true);
            }
        };

        window.loadReminders = () => {
            if (!isAuthReady || !userId) {
                document.getElementById('reminders-list').innerHTML = '<p class="text-center text-gray-500">Zaloguj siƒô, aby zobaczyƒá swoje przypomnienia.</p>';
                return;
            }
            const collectionPath = `/artifacts/${appId}/users/${userId}/reminders`;
            const remindersList = document.getElementById('reminders-list');
            remindersList.innerHTML = '<p class="text-center text-gray-500">≈Åadowanie przypomnie≈Ñ...</p>';
            
            const remindersQuery = query(collection(db, collectionPath));
            onSnapshot(remindersQuery, (querySnapshot) => {
                remindersList.innerHTML = '';
                if (querySnapshot.empty) {
                    remindersList.innerHTML = '<p class="text-center text-gray-500">Brak przypomnie≈Ñ. Dodaj nowe!</p>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const reminderItem = document.createElement('div');
                    reminderItem.className = 'reminder-item';
                    reminderItem.innerHTML = `
                        <span>${data.text}</span>
                        <button class="delete-btn" onclick="deleteReminder('${doc.id}')">Usu≈Ñ</button>
                    `;
                    remindersList.appendChild(reminderItem);
                });
            });
        };

        window.deleteReminder = async (docId) => {
            if (!isAuthReady || !userId) {
                showMessage('Musisz byƒá zalogowany, aby usunƒÖƒá przypomnienie.', true);
                return;
            }
            const collectionPath = `/artifacts/${appId}/users/${userId}/reminders`;
            try {
                await deleteDoc(doc(db, collectionPath, docId));
                showMessage('Usuniƒôto przypomnienie.');
            } catch (e) {
                console.error("B≈ÇƒÖd podczas usuwania przypomnienia: ", e);
                showMessage("B≈ÇƒÖd podczas usuwania przypomnienia.", true);
            }
        };

    </script>
    
    <script>
        // Funkcje do zarzƒÖdzania wy≈õwietlanymi ekranami
        function showScreen(screenId) {
            document.querySelectorAll('#app-container > div').forEach(div => {
                div.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showMainScreen() { showScreen('main-screen'); }
        function showReminders() { 
            showScreen('reminders-screen');
            // Wywo≈Çaj loadReminders tylko, gdy u≈ºytkownik jest zalogowany
            if (window.auth && window.auth.currentUser) {
                loadReminders();
            }
        }
        function showGames() { showScreen('games-screen'); }
        function showRanking() {
            showScreen('ranking-screen');
            loadScores();
        }
        function showMemoryGame() { 
            showScreen('memory-game-screen'); 
            resetMemoryGame();
        }
        function showLogicGame() { 
            showScreen('logic-game-screen'); 
            generateProverbProblem();
        }
        function showMathGame() { 
            showScreen('math-game-screen'); 
            generateMathProblem();
        }

        // Funkcje dla zegara i daty
        function updateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit' };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('time-display').innerText = now.toLocaleTimeString('pl-PL', timeOptions);
            document.getElementById('date-display').innerText = now.toLocaleDateString('pl-PL', dateOptions);
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Funkcja do pokazywania wiadomo≈õci
        function showMessage(text, isError = false) {
            const msgBox = document.getElementById('message-box');
            msgBox.innerText = text;
            msgBox.style.backgroundColor = isError ? '#f44336' : '#4CAF50';
            msgBox.classList.add('show');
            setTimeout(() => {
                msgBox.classList.remove('show');
            }, 3000);
        }

        // ----- Logika gier -----

        // Gra Pamiƒôciowa
        let memoryCards = [];
        let firstCard = null;
        let secondCard = null;
        let lockBoard = false;
        let memoryScore = 0;

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function createMemoryBoard() {
            const emojis = ['üçá', 'üçâ', 'üçä', 'üçã', 'üçå', 'üçç', 'ü•≠', 'üçé'];
            memoryCards = [...emojis, ...emojis];
            shuffle(memoryCards);

            const grid = document.getElementById('memory-grid');
            grid.innerHTML = '';
            memoryCards.forEach((emoji, index) => {
                const card = document.createElement('div');
                card.classList.add('card', 'bg-blue-300', 'p-4', 'rounded-lg', 'text-5xl', 'flex', 'items-center', 'justify-center', 'cursor-pointer', 'text-white', 'hover:bg-blue-400');
                card.innerHTML = `<span class="hidden">${emoji}</span>`;
                card.dataset.index = index;
                card.addEventListener('click', flipCard);
                grid.appendChild(card);
            });
        }

        function flipCard(event) {
            if (lockBoard) return;
            const target = event.currentTarget;
            if (target === firstCard) return;

            target.classList.remove('bg-blue-300', 'hover:bg-blue-400');
            target.classList.add('bg-white', 'text-black');
            target.querySelector('span').classList.remove('hidden');

            if (!firstCard) {
                firstCard = target;
                return;
            }

            secondCard = target;
            lockBoard = true;
            checkForMatch();
        }

        function checkForMatch() {
            const isMatch = firstCard.querySelector('span').innerText === secondCard.querySelector('span').innerText;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);
            memoryScore += 10;
            document.getElementById('memory-score').innerText = memoryScore;
            showMessage('Para znaleziona!');
            // Sprawd≈∫, czy gra siƒô sko≈Ñczy≈Ça
            if (document.querySelectorAll('#memory-grid span:not(.hidden)').length === memoryCards.length) {
                setTimeout(() => {
                    showMessage(`Gra sko≈Ñczona! Tw√≥j wynik: ${memoryScore}`);
                    saveScore('Gra Pamiƒôciowa', memoryScore);
                }, 1000);
            }
            resetBoard();
        }

        function unflipCards() {
            setTimeout(() => {
                firstCard.classList.add('bg-blue-300', 'hover:bg-blue-400');
                firstCard.classList.remove('bg-white', 'text-black');
                firstCard.querySelector('span').classList.add('hidden');
                secondCard.classList.add('bg-blue-300', 'hover:bg-blue-400');
                secondCard.classList.remove('bg-white', 'text-black');
                secondCard.querySelector('span').classList.add('hidden');
                memoryScore = Math.max(0, memoryScore - 2);
                document.getElementById('memory-score').innerText = memoryScore;
                showMessage('Spr√≥buj jeszcze raz.', true);
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [firstCard, secondCard, lockBoard] = [null, null, false];
        }

        function resetMemoryGame() {
            memoryScore = 0;
            document.getElementById('memory-score').innerText = memoryScore;
            createMemoryBoard();
            resetBoard();
        }

        // Gra Logiczna
        let logicScore = 0;
        const proverbs = [
            { start: "Kto rano wstaje...", end: "temu Pan B√≥g daje.", options: ["...temu siƒô ≈õpieszy.", "...temu Pan B√≥g daje.", "...temu kawa ucieka.", "...temu s≈Ço≈Ñce wschodzi."] },
            { start: "Lepszy wr√≥bel w gar≈õci...", end: "ni≈º go≈ÇƒÖb na dachu.", options: ["...ni≈º sowa na dachu.", "...ni≈º go≈ÇƒÖb na dachu.", "...ni≈º sok√≥≈Ç w powietrzu.", "...ni≈º kura na grzƒôdzie."] },
            { start: "Gdzie kucharek sze≈õƒá...", end: "tam nie ma co je≈õƒá.", options: ["...tam jest du≈ºy ba≈Çagan.", "...tam nie ma co je≈õƒá.", "...tam jest smaczny obiad.", "...tam jest wielkie gotowanie."] },
            { start: "Bez pracy...", end: "nie ma ko≈Çaczy.", options: ["...nie ma odpoczynku.", "...nie ma pieniƒôdzy.", "...nie ma zabawy.", "...nie ma ko≈Çaczy."] },
            { start: "Co za du≈ºo...", end: "to niezdrowo.", options: ["...to dobrze.", "...to za du≈ºo.", "...to niezdrowo.", "...to lepiej."] }
        ];

        function generateProverbProblem() {
            const problem = proverbs[Math.floor(Math.random() * proverbs.length)];
            document.getElementById('proverb-start').innerText = problem.start;
            const optionsContainer = document.getElementById('proverb-options');
            optionsContainer.innerHTML = '';
            
            shuffle(problem.options);
            problem.options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('menu-button', 'bg-blue-300', 'text-gray-800', 'hover:bg-blue-400', 'focus:outline-none', 'focus:ring-4', 'focus:ring-blue-300');
                button.innerText = option;
                button.onclick = () => checkProverbAnswer(option, problem.end);
                optionsContainer.appendChild(button);
            });
        }

        function checkProverbAnswer(selected, correct) {
            if (selected === correct) {
                logicScore++;
                document.getElementById('logic-score').innerText = logicScore;
                showMessage('Poprawna odpowied≈∫!');
            } else {
                showMessage(`Niepoprawna odpowied≈∫. Prawid≈Çowa to: ${correct}`, true);
            }
            setTimeout(generateProverbProblem, 2000);
        }

        // Gra Matematyczna
        let mathProblem = {};
        let mathScore = 0;

        function generateMathProblem() {
            const num1 = Math.floor(Math.random() * 20) + 1;
            const num2 = Math.floor(Math.random() * 20) + 1;
            const operators = ['+', '-', '*'];
            const operator = operators[Math.floor(Math.random() * operators.length)];

            let problemText = '';
            let answer;

            switch (operator) {
                case '+':
                    problemText = `${num1} + ${num2} = ?`;
                    answer = num1 + num2;
                    break;
                case '-':
                    problemText = `${Math.max(num1, num2)} - ${Math.min(num1, num2)} = ?`;
                    answer = Math.max(num1, num2) - Math.min(num1, num2);
                    break;
                case '*':
                    problemText = `${num1} x ${num2} = ?`;
                    answer = num1 * num2;
                    break;
            }

            mathProblem = { problemText, answer };
            document.getElementById('math-problem').innerText = problemText;
            document.getElementById('math-answer').value = '';
        }

        function checkMathAnswer() {
            const userAnswer = parseInt(document.getElementById('math-answer').value, 10);
            if (userAnswer === mathProblem.answer) {
                mathScore++;
                document.getElementById('math-score').innerText = mathScore;
                showMessage('Poprawna odpowied≈∫!');
            } else {
                showMessage(`Niepoprawna odpowied≈∫. Prawid≈Çowa to: ${mathProblem.answer}`, true);
                saveScore('Gra Matematyczna', mathScore);
                mathScore = 0;
                document.getElementById('math-score').innerText = mathScore;
            }
            generateMathProblem();
        }
    </script>
</body>
</html>